---
title: "仮想マシンの作成:UTokyo Azure 利用例"
---

## 概要
{:#about}

本サービスで多く利用されると思われる，仮想マシン（Azure のサービス名はVirtual Machines）の作成を最低限の構成で行う一例です．

## １．サービスを選択する
{:#select_service}

- 事前に以下サイトよりサブスクリプションを申請してください．
  - 東京大学 Azureクラウド利用申請ページ(公開時にリンク) ※UTokyo Account 所持者のみアクセス可

- [Azure portal](https://portal.azure.com/)に[UTokyo Account](/utokyo_account)でログインし、リソースの欄に申請したサブスクリプションがあることを確認してください．

![](img/01_login.png){:.medium.center.border}

- Azureサービスの一覧の中から`Virtual Machines`を選択します．
    - 一覧に無い場合、一覧の右にある`その他のサービス`を選択、左側にあるリストから`コンピューティング`を選択すると，右側に表示されるメイン画面の`Infrastructure as a Service(IaaS)`の中にあります．

![](img/02_selectvm.png){:.medium.center.border}

- Virtual Machines のメインページが表示されたら，`＋作成`をクリックします．

![](img/03_start.png){:.medium.center.border}

- どの方法で仮想マシンを作成するかの選択肢が出てきますが，以下`Azure仮想マシン`を選択したものとしています．

## ２．仮想マシンを構成する
{:#vmconfig}

> **補足**：説明のない項目は，基本的に初期設定のままで構成することを前提としています．

### 基本パート
{:#base}

#### プロジェクトの詳細

- **サブスクリプション**：事前に申請したサブスクリプションがすでに設定されていますので、通常はそのままで問題ありません．複数のサブスクリプションをお持ちで、想定していないサブスクリプションが表示されている場合はプルダウンメニューから選択しなおしてください．ここを間違えると想定していない予算から支出することになりますので，よくご確認お願いします．
- **リソースグループ**：仮想マシンは個々のパーツをそれぞれ独立したリソースとして管理するため，同じポリシーで構成されるリソースはリソースグループでまとめて一括管理します．ここでは新規に`resource_group`というリソースグループ名で作成し，そこに以下作成される各リソースをまとめます．

![](img/04_base1.png){:.medium.center.border}

#### インスタンスの詳細

- **仮想マシン名**：仮想マシンをAzure Portal 内で管理する際の名称です．わかりやすい名称を入力してくだささい．ここでは`testmachine`と入力しています．
- **リージョン**：仮想マシンをどの地域（リージョン）にあるデータセンターにデプロイするかを指定します．通常は日本国内（`Japan East` か`Japan West`）のリージョンを選択してください．
- **可用性オプション**：`インフラストラクチャ冗長は必要ありません`を選択してください．
- **イメージ**：利用したいＯＳを選択してください．ここでは`ubuntu`を選択しています．
- **サイズ**：CPUコア数やメモリ量などの組み合わせを選択してください．右側にある金額は，それを選択した際にかかると予想さ れる費用（月額）です．

![](img/05_base2.png){:.medium.center.border}

#### 管理者アカウント

初期設定のままで構いません．**認証の種類**が`SSH公開キー`になっていない場合は選択してください．

#### 受信ポートの規則

初期設定のままで構いません．既にご希望がある場合は設定を変更してください．

### ディスクパート
{:#disk}

#### VMディスクの暗号化

初期設定のままで構いません．既にご希望がある場合は設定を変更してください．

#### OSディスク

- **OSディスクサイズ**：いくつかのサイズから選択できますので，必要な容量を選択ください．
- **OSディスクの種類**：初期選択の`Premium SSD`は Standard HDD の約３～５倍，`Standard SSD`は約２倍の費用がかかるので．ディスクに高性能を求める構成でなければ`Satndard HDD`をご選択ください．

![](img/06_osdisk.png){:.medium.center.border}

### ネットワークパート
{:#network}

初期設定のままで構いません．既にご希望がある場合は設定を変更してください．

### 管理パート
{:#management}

初期設定のままで構いません．既にご希望がある場合は設定を変更してください．

### 監視パート
{:#monitoring}

初期設定のままで構いません．既にご希望がある場合は設定を変更してください．

### 詳細パート
{:#addconfig}

初期設定のままで構いません．既にご希望がある場合は設定を変更してください．

### タグパート
{:#tag}

初期設定のままで構いません．既にご希望がある場合は設定を変更してください．

### 確認及び作成パート
{:#execute}

構成内容の検証結果，１時間ごとの予想費用，使用条件及びここまで設定してきた内容の詳細の確認の画面が表示されるので，問題が無ければ画面左下の`確認及び作成`ボタンをクリックしてください．

![](img/07_confirm1.png){:.medium.center.border}

## ３．仮想マシンを作成する
{:#vmmake}

`確認及び作成`をクリックするとVM作成が実行されます．

- SSH鍵ペアの秘密鍵をダウンロードするかどうかの選択が表示されるので，ダウンロードしてください．リモートから初期アクセス する際にこの秘密鍵を使ってログインします．作成した仮想マシンにログインするリモート端末の適切な場所に，秘密鍵を事前に配置してください．

![](img/08_sshkey.png){:.medium.center.border}

デプロイが完了しましたと表示されたら作成終了です．

![](img/09_complete.png){:.medium.center.border}

## ４．仮想マシンにログインする

`リソースに移動`または仮想マシンリソース名のリンクをクリックすると，割り当てられたグローバルIPアドレスが画面右側に表示されていますので，そのIPアドレスに対してご自身の端末からSSHログインを行いログインできたら完了です．

![](img/11_ipaddress.png){:.medium.center.border}

  - `ssh -i [ダウンロードした秘密鍵] azureuser@[IPアドレス]`

![](img/12_sshlogin.png){:.small.center.border}

ログイン後は必要に応じて，作業用アカウントの作成や /etc/sudoers の編集などを行ってください．
